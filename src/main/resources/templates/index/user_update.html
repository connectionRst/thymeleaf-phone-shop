<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>用户修改个人信息页面</title>
    <script src="/old/js/jquery-3.4.1.js" ></script>
    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link href="/old/css/style.css" rel="stylesheet">
    <script src="/old/js/bootstrap.js" type="text/javascript"></script>
    <link href="/old/css/layui.css" media="all" rel="stylesheet">
    <script src="/old/js/layui.js" type="text/javascript"></script>
    <link href="/old/css/admin.css" rel="stylesheet">
    <link href="/old/css/login.css" rel="stylesheet" >
    <link href="/old/css/index.css" rel="stylesheet">
    <style>
        .current{
            background-color: rgba(20,8,31,0.55);
        }
    </style>
</head>
<body>
<nav style="background-color:orange;" th:include="/index/header :: header"></nav>
<br><br><br><br><br>
<div class="container-fluid">
    <div class="layadmin-user-login-box layadmin-user-login-header">
        <h2>修改个人信息</h2>
    </div>
    <br>
    <div style="width:500px;height:auto;margin:0 auto;">
        <form class="layui-form" id="updateForm">
            <input type="hidden" name="id" id="id" th:value="${user.id}">
            <div class="layui-form-item" >
                <label class="layui-form-label" for="name">用户名:</label>
                <div class="layui-input-block">
                    <input type="text" name="name" id="name"
                           lay-verify="required" placeholder="请输入用户名" th:value="${user.name}"
                           class="layui-input" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">电话:</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" id="phone"
                           lay-verify="phone" placeholder="请输入电话号码" th:value="${user.phone}"
                           class="layui-input" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">头像:</label>
                <div class="layui-input-block">
                    <input type="hidden" id="image" name="avatar"  th:value="${user.avatar}">
                    <img style="width:100px;height:100px;" th:src="@{{avatar}(avatar=${user.avatar})}">
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="button" id="imageBtn" class="layui-btn" >
                        <i class="layui-icon">&#xe67c;</i>上传本地照片
                    </button>
                </div>
            </div>
            <div id="headerView" class="layui-form-item" style="display: none">
                <label class="layui-form-label">新头像预览:</label>
                <div class="layui-input-block">
                    <img id="PreViewH" style="width:100px;height:100px;border-radius:50%">
                </div>
            </div>
            <br>
            <div class="layui-form-item" style="padding-left:110px;">
                <button type="submit" class="layui-btn" lay-filter="update-submit" lay-submit="">点击修改</button>
                <button type="reset" class="layui-btn layui-btn-warm">重置内容</button>
            </div>
        </form>
    </div>
    <br><br>
    <div th:include="/index/footer :: footer"></div>
</div>

<script src="/old/js/jquery-3.4.1.js" ></script>
<script type="text/javascript">
    layui.use(['form','layer','laydate',"upload"], function() {
        var form = layui.form;
        var layer=layui.layer;
        var $ = layui.jquery;
        var laydate = layui.laydate;
        var upload = layui.upload;

        //图片上传
        upload.render({
            elem:'#imageBtn',
            url:'/image/upload',
            data: {
                "type" : "head"
            },
            done:function (res) {
                layer.msg('上传图片成功！',{icon:1, anim:4, time:1000, shade:0.4});
                $("#image").prop("value",res.msg);
                $("#PreViewH").prop("src", res.msg);
                $("#headerView").css("display","inline")
            },
            error:function () {
                layer.msg('上传图片失败！',{icon:5, time:1000, shade:0.4});
            }
        });

        //监听提交
        form.on('submit(update-submit)', function (data) {
            $.ajax({
                url:'/user/update',
                type:'post',
                data:data.field,
                success:function (data) {
                    if (data.code == 200) {
                        layer.msg("修改信息成功！即将跳转到商城主页！",{icon:1, shade:0.4, time:1500},function() {
                            window.location.href = "/";
                        });
                    } else {
                        layer.msg(data.msg, {icon:2, time:1000, shade:0.4})
                    }
                },
                error:function (data) {
                    layer.msg(data.msg, {icon:2, time:1000, shade:0.4})
                }
            })
            return false;
        });

        $("#logout").click(function () {
            layer.open({
                title:'提示',
                type:1,
                offset:'auto',
                content:'<div style="padding: 20px 60px;font-size: 15px">'+ '您是否确定注销登录?' +'</div>',
                btn:['确定','取消'],
                btnAlign:'c',
                shade:0,
                yes:function () {
                    $.ajax({
                        type:"get",
                        url:"/user/logout",
                        success:function(data){
                            if (data.code == 200){
                                window.location.href="/userLogin";
                            }else {
                                layer.msg("注销登录失败",{icon:5});
                            }
                        },
                        error:function () {
                            layer.msg("请求失败",{icon:5});
                        }
                    });
                },
                btn2:function () {
                    layer.closeAll();
                }

            });
        });
    });
</script>
<script>
    $("#test>li").mouseenter(function () {
        $(this).addClass("current");
    });
    $("#test>li").mouseleave(function () {
        $(this).removeClass("current");
    });
</script>
</body>
</html>