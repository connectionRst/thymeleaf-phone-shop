<!DOCTYPE html>
<html class="no-js" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>商品详情</title>
    <link href="/old/css/layui.css" media="all" rel="stylesheet">
    <script src="/old/js/layui.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/old/css/alert.css">
    <link href="/old/assets2/css/vendor/font-awesome.css" rel="stylesheet">
    <link href="/old/assets2/css/plugins.css" rel="stylesheet">
    <link href="/old/assets2/css/helper.min.css" rel="stylesheet">
    <link href="/old/assets2/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="/old/css/default.css">
    <link rel="stylesheet" href="/old/css/singleShop.css">
    <script rc="/old/assets2/js/vendor/modernizr-2.8.3.min.js"></script>

    <script src="/old/js/jquery-3.4.1.js" ></script>
    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link href="/old/css/style.css" rel="stylesheet">
    <script src="/old/js/bootstrap.js" type="text/javascript"></script>
    <link href="/old/css/layui.css" media="all" rel="stylesheet">
    <style>
        .current{
            background-color: rgba(20,8,31,0.55);
        }
    </style>
</head>

<body style="background-color: white">
<nav style="background-color:orange;" th:include="/index/header :: header"></nav>
<div id="page-content-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="single-product-page-content">
                    <div class="row">
                        <div class="col-lg-5">
                            <div class="product-thumbnail-wrap">
                                <div class="product-thumb-carousel owl-carousel">
                                    <div class="single-thumb-item" >
                                        <a href="#"><img width="400px" height="360px" th:src="@{${good.getImage()}}" class="img-fluid"  alt=""/></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-7">
                            <div class="product-details">
                                <h2></h2>
                                <div id="wrap">
                                    <div id="bottom">
                                        <p >商品id：<span id="goodId">[[${good.getId()}]]</span></p><br>
                                        <p>价格： <font>￥ <span id='price'>[[${good.getPrice()}]]</span></font></p><br>
                                        <p>商品名称：<span>[[${good.getName()}]]</span></p><br>
                                        <p>商品属性：<span>[[${good.getSku()}]]</span></p><br>
                                        <p>商品描述：<span>[[${good.getRemark()}]]</span></p><br>
                                        <p >剩余数量：<span id="goodsNums">[[${good.getStock()}]]</span></p><br>
<!--                                        <p><span>请选择购买数量：[一次性限购五个]</span></p><br>-->
<!--                                        <div style="height: 38px;padding-top:5px;" id="text">-->
<!--                                            <button id="redbtn" class="layui-btn layui-btn-sm layui-btn-danger" style="float: left;">-</button>-->
<!--                                            <div class="layui-input-inline" style="width: 50px; float: left;margin-right: 5px;margin-left: 5px">-->
<!--                                                <input style="height: 30px" type="text" id="num" name="num" autocomplete="off" value="1" readonly class="layui-input">-->
<!--                                            </div>-->
<!--                                            <button id="addbtn" class="layui-btn layui-btn-sm layui-btn-danger" style="float: left;">+</button>-->
<!--                                        </div>-->
                                        <br>
                                        <div class="product-quantity d-flex align-items-center">
                                            <button class="btn btn-cart-large" id="gos" style="width: 200px;background-color: orangered" th:onclick="cartGoods([[${good.id}]])">
                                                <i class="fa fa-shopping-cart"></i> 加入购物车
                                            </button>
                                        </div>
                                        <div class="product-btn-group">
                                            <a th:onclick="cartGoods([[${good.id}]])" class="btn btn-round btn-cart" title="加入购物车" ><i class="fa fa-shopping-cart"></i></a>
                                            <a th:onclick="collectGoodsById([[${good.id}]])" class="btn btn-round btn-cart" title="加入收藏夹" ><i class="fa fa-heart"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Product Details End -->
                    </div>

                    <br><br><br>
                    <div class="row clearfix" style="margin-left: 100px">
                        <h3 style="padding-left:30px;">商品评价区域：</h3>
                        <div class="col-md-12 column">
                            <div class="media-body" style="padding-left:20px;">
                                <div th:if="${#lists.isEmpty(commentList)}">
                                    <hr>
                                    <h4 style="color: gray">本商品暂无评价信息</h4>
                                </div>
                                <div th:each="comment:${commentList}">
                                    <hr class="layui-bg-orange">
                                    <a href="javascript:;" class="media-left" style="float: left;">
                                        <img class="layui-nav-img" th:src="@{${comment.getUserAvatar()}}" style="height:55px; width:55px;">
                                    </a>
                                    <div class="pad-btm">
                                        <p class="fontColor"><span>已购商品用户</span>
                                            <div th:switch="${comment.getLevel()}">
                                        <p th:case="1">好评</p>
                                        <p th:case="2">中评</p>
                                        <p th:case="3">差评</p>
                                    </div>
                                    </p>
                                    <p class="fontColor">
                                        <span>[[${comment.getFmtDateTime()}]]</span>
                                    </p>
                                </div>
                                <p class="message-text"><span>评论内容：</span>[[${comment.getContent()}]]</p>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="/old/js/jquery-3.4.1.js" ></script>
<script src="/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="/js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script src="/old/assets2/js/vendor/jquery-3.3.1.min.js"></script>
<script src="/old/assets2/js/vendor/jquery-migrate-1.4.1.min.js"></script>
<script src="/old/assets2/js/vendor/popper.min.js"></script>
<script src="/old/assets2/js/vendor/bootstrap.min.js"></script>
<script src="/old/assets2/js/ajax-mail.js"></script>
<script src="/old/assets2/js/plugins.js"></script>
<script src="/old/assets2/js/active.js"></script>
<script src="/old/js/alert.js"></script>
<script src="/old/js/shopIndex.js"></script>
<script>
    layui.use(['layer'],function () {
        var layer = layui.layer;

        getGoodsByIdBuy = function (goodsId) {
            var goodsNum = $("#goodsNums").text();
            var num = $("#num").val();
            if (goodsNum==0){
                layer.msg("抱歉，当前商品库存不足，暂时不能购买此商品。",{icon:5,time:900})
            }else if((goodsNum-num)<0){
                layer.msg("商品库存不足,请重新选择数量",{icon:5,time:900});
            }
            else {
                window.location.href="/goods/getGoodsByIdBuy/"+goodsId + "/" + num;
            }
        }

        /*加入购物车*/
        cartGoods = function(id) {
            $.ajax({
                type:"post",
                url:"/cart/add",
                data: {
                    goodId : id
                },
                success:function (data) {
                    if (data.code == 200){
                        layer.msg("已加入购物车",{icon:1,time:1000, shade:0.4});
                    } else {
                        layer.msg(data.msg, {icon:2, time:1500, shade:0.4})
                    }
                },
                error:function (data) {
                    layer.msg("请求失败");
                }
            })
        }

        collectGoodsById = function (goodId) {
            $.ajax({
                type:"post",
                url:"/collect/add",
                data : {
                    goodId : goodId,
                },
                success:function (data) {
                    if (data.code == 200){
                        layer.msg("已将该商品加入收藏夹",{icon:1,time:1000, shade:0.4});
                    } else {
                        layer.msg(data.msg, {icon:2, time:1500, shade:0.4})
                    }
                }
            });
        }

        $("#test>li").mouseenter(function () {
            $(this).addClass("current");
        });
        $("#test>li").mouseleave(function () {
            $(this).removeClass("current");
        });
        // $("#addbtn").click(function () {
        //     var num = parseInt($("#num").val());
        //     if(num>=5){
        //         $("#addbtn").prop("disable",true);
        //     }else {
        //         $("#num").val(num + 1);
        //     }
        // })
        // $("#redbtn").click(function () {
        //     var num = parseInt($("#num").val());
        //     if (num-1<=0){
        //         $("#redbtn").prop("disable",true);
        //     }else {
        //         num--;
        //         $("#num").val(num);
        //     }
        // });

        $("#logout").click(function () {
            layer.open({
                title:'提示',
                type:1,
                offset:'auto',
                content:'<div style="padding: 20px 60px;font-size: 15px">'+ '您是否确定注销登录?' +'</div>',
                btn:['确定','取消'],
                btnAlign:'c',
                shade:0,
                yes:function () {
                    $.ajax({
                        type:"get",
                        url:"/user/logout",
                        success:function(data){
                            if (data.code == 200){
                                window.location.href="/userLogin";
                            }else {
                                layer.msg("注销登录失败",{icon:5});
                            }
                        },
                        error:function () {
                            layer.msg("请求失败",{icon:5});
                        }
                    });
                },
                btn2:function () {
                    layer.closeAll();
                }

            });
        });
    });
</script>

</body>
</html>
