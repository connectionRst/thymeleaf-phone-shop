<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/old/js/jquery-3.4.1.js" ></script>
    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link href="/old/css/style.css" rel="stylesheet">
    <script src="/old/js/bootstrap.js" type="text/javascript"></script>
    <link href="/old/css/layui.css" media="all" rel="stylesheet">
    <script src="/old/js/layui.js" type="text/javascript"></script>
    <link href="/old/css/admin.css" rel="stylesheet">
    <link href="/old/css/login.css" rel="stylesheet">
    <link href="/old/css/index.css" rel="stylesheet">
    <style>
        .current{
            background-color: rgba(20,8,31,0.55);
        }
    </style>
</head>
<body>
<nav style="background-color:orange;" th:include="/index/header :: header"></nav>
<br><br><br><br><br>
<div class="container-fluid">
    <div class="layadmin-user-login-box layadmin-user-login-header">
        <h2>修改密码</h2>
    </div>
    <br>
    <form class="layui-form" id="pwdForm" form autocomplete="off">
    <div style="width:550px;height:auto;margin:0 auto;">
            <div class="layui-form-item" >
                <label class="layui-form-label" for="oldPassword">原始密码:</label>
                <div class="layui-input-block">
                    <input type="password" name="oldPassword" id="oldPassword"
                           lay-verify="required" placeholder="请输入原始密码" class="layui-input" />
                </div>
            </div>
            <br>
            <div class="layui-form-item" >
                <label class="layui-form-label" for="newPassword">新的密码:</label>
                <div class="layui-input-block">
                    <input type="password" name="newPassword" id="newPassword"
                           lay-verify="required" placeholder="请输入新的密码" class="layui-input" />
                </div>
            </div>
            <br>
            <div class="layui-form-item" >
                <label class="layui-form-label" for="reqPassword">确认密码:</label>
                <div class="layui-input-block">
                    <input type="required" name="reqPassword" id="reqPassword"
                           lay-verify="rePwd" placeholder="确认密码" class="layui-input" />
                </div>
            </div>
            <br>
            <div class="layui-form-item" style="padding-left:110px;">
                <button type="submit" class="layui-btn" lay-filter="upPwd-submit" lay-submit="">点击修改</button>
                <button type="reset" class="layui-btn layui-btn-warm">重置内容</button>
            </div>
    </div>
    </form>
    </div>
    <br><br>
<div th:include="/index/footer :: footer"></div>
</div>
<script type="text/javascript">
    layui.use(['form','layer','laydate',"upload"], function() {
        var form = layui.form;
        var layer=layui.layer;
        var $ = layui.jquery;
        var laydate = layui.laydate;
        var upload = layui.upload;

        form.on('submit(upPwd-submit)',function () {
            var oldPassword = $("#oldPassword").val();
            var newPassword = $("#newPassword").val();
            var reqPassword = $("#reqPassword").val();
            if (reqPassword != newPassword) {
                layer.msg("确认密码输入有误")
                return false;
            }
            $.ajax({
                type:"post",
                url:"/user/updatePwd",
                data : {
                    oldPassword : oldPassword,
                    newPassword : newPassword
                },
                success:function (data) {
                    if (data.code == 200){
                        layer.msg("修改密码成功！请重新登录！",{icon:1,shade:0.4,time:1500},function() {
                            window.location.href = "/userLogin"
                        });
                    }else{
                        layer.msg(data.msg,{icon:5,shade:0.4,time:1500});
                    }
                }
            });
            return false;
        });

        $("#logout").click(function () {
            layer.open({
                title:'提示',
                type:1,
                offset:'auto',
                content:'<div style="padding: 20px 60px;font-size: 15px">'+ '您是否确定注销登录?' +'</div>',
                btn:['确定','取消'],
                btnAlign:'c',
                shade:0,
                yes:function () {
                    $.ajax({
                        type:"get",
                        url:"/user/logout",
                        success:function(data){
                            if (data.code == 200){
                                window.location.href="/userLogin";
                            }else {
                                layer.msg("注销登录失败",{icon:5});
                            }
                        },
                        error:function () {
                            layer.msg("请求失败",{icon:5});
                        }
                    });
                },
                btn2:function () {
                    layer.closeAll();
                }

            });
        });
    });
</script>
</body>
</html>