<!DOCTYPE html>
<html class="no-js" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">

    <title>收藏夹</title>
    <link rel="stylesheet" href="/old/css/alert.css">
    <link href="/old/assets2/css/vendor/font-awesome.css" rel="stylesheet">
    <link href="/old/assets2/css/plugins.css" rel="stylesheet">
    <link href="/old/assets2/css/helper.min.css" rel="stylesheet">
    <link href="/old/assets2/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="/old/css/default.css">
    <link rel="stylesheet" href="/old/css/singleShop.css">
    <script src="/old/assets2/js/vendor/modernizr-2.8.3.min.js"></script>
    <!--header-->
    <script src="/old/js/jquery-3.4.1.js" ></script>
    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link href="/old/css/style.css" rel="stylesheet">
    <script src="/old/js/bootstrap.js" type="text/javascript"></script>
    <link href="/old/css/layui.css" media="all" rel="stylesheet">
    <script src="/old/js/layui.js" type="text/javascript"></script>
    <style>
        .current{
            background-color: rgba(20,8,31,0.55);
        }
    </style>

</head>

<body>
<nav style="background-color:orange;" th:include="/index/header :: header"></nav>
<br>

<div id="page-content-wrapper">
    <div class="container">
        <!-- Wishlist Page Content Start -->
        <div class="row">
            <div class="col-lg-12">
                <!-- Wishlist Table Area -->
                <div class="cart-table table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="pro-thumbnail">图片</th>
                            <th class="pro-title">商品名称</th>
                            <th class="pro-title">商品属性</th>
                            <th class="pro-price">价格(元)</th>
                            <th class="pro-quantity">库存量</th>
                            <th class="pro-subtotal">加入购物车</th>
                            <th class="pro-remove">删除</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(collectList)}">
                            <h2>暂无收藏的商品</h2>
                        </tr>
                        <tr th:if="${not #lists.isEmpty(collectList)}">
                            <h2>我的收藏夹</h2>
                        </tr>
                        <tr th:if="${not #lists.isEmpty(collectList)}" th:each="collect:${collectList}">
                            <td class="pro-thumbnail"><a th:onclick="getGoodsDetail([[${collect.goodId}]])"><img style="width: 75px;height: 60px" th:src="@{${collect.getGoodImg()}}" class="img-fluid" /></a></td>
                            <td class="pro-title"><a th:onclick="getGoodsDetail([[${collect.goodId}]])" th:text="${collect.getGoodName()}"></a></td>
                            <td class="pro-price"><span th:text="${collect.getGoodSku()}"></span></td>
                            <td class="pro-price"><span th:text="${collect.getGoodPrice()}"></span></td>
                            <td class="pro-quantity"><span th:text="${collect.getGoodStock()}"></span></td>
                            <td class="pro-subtotal"><a href="#" th:onclick="cartGoods([[${collect.goodId}]])" class="btn-add-to-cart" >加入购物车</a></td>
                            <td class="pro-remove"><a href="javascript:void(0);" th:onclick="removeCollect([[${collect.goodId}]])" data-toggle="modal" data-target="#myModal"><i class="fa fa-trash-o"></i></a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Wishlist Page Content End -->
    </div>
</div>

<script src="/old/assets2/js/vendor/jquery-3.3.1.min.js"></script>
<script src="/old/assets2/js/vendor/jquery-migrate-1.4.1.min.js"></script>
<script src="/old/assets2/js/vendor/popper.min.js"></script>
<script src="/old/assets2/js/vendor/bootstrap.min.js"></script>
<script src="/old/assets2/js/plugins.js"></script>
<script src="/old/assets2/js/active.js"></script>
<script src="/old/js/alert.js"></script>
<script src="/old/index/js/jquery-3.3.1.min.js"></script>
<script src="/old/js/layui.js"></script>
<script>
    layui.use(['layer'],function () {
        var layer = layui.layer;
        $("#logout").click(function () {
            layer.open({
                title:'提示',
                type:1,
                offset:'auto',
                content:'<div style="padding: 20px 60px;font-size: 15px">'+ '您是否确定注销登录?' +'</div>',
                btn:['确定','取消'],
                btnAlign:'c',
                shade:0,
                yes:function () {
                    $.ajax({
                        type:"get",
                        url:"/user/logout",
                        success:function(data){
                            if (data.code == 200){
                                window.location.href="/userLogin";
                            }else {
                                layer.msg("注销登录失败",{icon:5});
                            }
                        },
                        error:function () {
                            layer.msg("请求失败",{icon:5});
                        }
                    });
                },
                btn2:function () {
                    layer.closeAll();
                }

            });
        });
    });
    getGoodsDetail = function(goodsId){
        window.location.href="/good/getGoodDetail?goodId="+goodsId;
    }

    $("#test>li").mouseenter(function () {
        $(this).addClass("current");
    });
    $("#test>li").mouseleave(function () {
        $(this).removeClass("current");
    })

    /*加入购物车*/
    cartGoods = function(id) {
        $.ajax({
            type:"post",
            url:"/cart/add",
            data: {
                goodId : id
            },
            success:function (data) {
                if (data.code == 200){
                    layer.msg("已加入购物车",{icon:1,time:1000, shade:0.4});
                } else {
                    layer.msg(data.msg, {icon:2, time:1500, shade:0.4})
                }
            },
            error:function (data) {
                layer.msg("请求失败");
            }
        })
    }

    removeCollect = function (goodId) {
        layer.open({
            title:'提示',
            type:1,
            offset:'auto',
            content:'<div style="padding: 20px 50px;font-size: 15px">'+ '是否取消收藏该商品?' +'</div>',
            btn:['是','否'],
            btnAlign:'c',
            shade:0,
            yes:function () {
                $.ajax({
                    type:"post",
                    url:"/collect/delete",
                    data: {
                        goodId : goodId
                    },
                    success:function(data){
                        if (data.code == 200){
                            layer.msg("取消收藏成功",{icon:1, time:1000, shade:0.4},function () {
                                window.location.href="/collect/getAll"
                            });
                        } else {
                            layer.msg(data.msg, {icon:2, time:1500, shade:0.4})
                        }
                    },
                    error:function () {
                        layer.msg("请求失败",{icon:5});
                    }
                });
            },
            btn2:function () {
                layer.closeAll();
            }
        });
    }
    $("#delete").click(function () {
        $("#deleteForm").submit();
    })
</script>
</body>
</html>
