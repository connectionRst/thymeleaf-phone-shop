<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title></title>
    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="/old/css/layui.css">



    <link rel="stylesheet" href="/old/css/order/mygxin.css">
    <link rel="stylesheet" href="/old/css/order/proList.css">
    <link rel="stylesheet" href="/old/css/order/public.css">
    <link rel="stylesheet" href="/old/css/order/sweetalert.css">

    <link href="/old/css/index.css" rel="stylesheet">
    <script src="/old/js/jquery-3.4.1.js"></script>
    <script src="/old/js/layui.js"></script>
    <script src="/old/js/bootstrap.js" type="text/javascript"></script>
    <script src="/old/js/public.js" type="text/javascript" charset="utf-8"></script>
    <script src="/old/js/pro.js" type="text/javascript" charset="utf-8"></script>
    <script src="/old/js/user.js" type="text/javascript" charset="utf-8"></script>
    <script src="/old/js/sweetalert.min.js"></script>
    <script src="/old/js/address.js"></script>
    <script src="/old/js/cart.js"></script>
    <script src="/old/js/distpicker.data.js"></script>
    <script src="/old/js/main.js"></script>
    <script src="/old/js/distpicker.js"></script>
    <script src="/old/js/getParams.js"></script>

    <link href="/old/css/bootstrap.css" rel="stylesheet">
    <link href="/old/css/layui.css" media="all" rel="stylesheet">

</head>

<style>
    select{
        font-family: "微软雅黑";
        width: 249px;
        height: 40px;
        font-size: 18px;
        color: black;
        text-align: center;
        border: 1px #1a1a1a solid;
        border-radius: 5px;
    }

    select:focus{
        border: 2px #ddd solid;
        box-shadow: 0 0 15px 1px black;
    }
</style>

</head>
<body>
<nav style="background-color:orange;" th:include="/index/header :: header"></nav>
<div class="order cart mt">

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: #F2F2F2;">
                <div class="modal-header" style="background-color: #fff;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">选择地址</h4>
                </div>
                <div th:if="${#lists.isEmpty(addressList)}"><h3>暂无收货地址</h3></div>
                <div th:if="${not #lists.isEmpty(addressList)}" th:each="address : ${addressList}">
                <div style="width: 550px;height: 100px;margin: 20px 20px 20px 20px;">
                <div class="layui-card" style="height: 100px;">
                    <div class="layui-card-body" style="height: 100px;">
                            <div>
                                <div class="tit clearfix">
                                    <p class="fl" th:text="${address.getName()}">
                                    </p>
                                    <p class="fr">
                                        <a href="#" th:onclick="setDefault([[${address.getId()}]])">设为默认</a>
                                    </p>
                                </div>
                                <div class="addCon">
                                    <p th:text="${address.getProvince()}+' '+${address.getCity()}+' '+${address.getArea()}+' '+${address.getDetail()}"></p>
                                    <p th:text="${address.getPhone()}"></p>
                                </div>
                        </div>
                    </div>
                </div>
                </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-----------------site------------------->
    <div class="site">
        <p class="wrapper clearfix">
            <span class="fl">订单确认</span>
        </p>
    </div>
    <!-----------------orderCon------------------->
    <div class="orderCon wrapper clearfix">
        <div class="orderL fl">
            <h3>收件信息<a th:href="@{/userAddress}" class="fr" style="margin-left: 20px;" data-toggle="modal" >新增地址</a><a href="#" class="fr" style="margin-left: 20px;" data-toggle="modal" data-target="#myModal">选择地址</a></h3>
            <br>
            <div th:if="${#lists.isEmpty(addressList)}" style="text-align: center"><h3>暂无收货地址</h3></div>
            <div  th:if="${defAddress == null}"><h3 id="checkAddress">暂无收货信息</h3></div>
            <div  th:if="${defAddress != null}" class="addres clearfix" id="orderaddress" style="overflow: scroll; width: 720px;height: 400px;">
            <div>
                <div class="tit clearfix">
                    <p class="fl" th:text="${defAddress.getName()}">
                    </p>
                    <span style="color: red">[默认地址]</span>
                </div>
                <div class="addCon">
                    <p th:text="${defAddress.getProvince()}+' '+${defAddress.getCity()}+' '+${defAddress.getArea()}+' '+${defAddress.getDetail()}"></p>
                    <p th:text="${defAddress.getPhone()}"></p>
                </div>
            </div>
            </div>
            <h3>支付方式</h3>
            <!--------way---------------->
            <div class="way clearfix">
                <img class="on" th:src="@{'/images/aimg/way01.jpg'}">
            </div>

        </div>
        <div class="orderR fr">
            <div class="msg">
                <div th:each="good : ${goodList}">
                <!--------ul---------------->
<!--                <ul class="clearfix" th:if="${good.getId()==null}">-->
<!--                    <li class="fl">-->
<!--                        <img th:src="@{${good.getIamge()}}" style="width: 87px;height: 87px;">-->
<!--                    </li>-->
<!--                    <li class="fl">-->
<!--                        <p style="width:240px;height:auto;" th:text="${good.getName()}"></p>-->
<!--                        <p th:text="'数量：'+${good.getGoodBuyNum()}"></p>-->
<!--                    </li>-->
<!--                    <li class="fr" th:text="'￥'+${good.getPrice()}"></li>-->
<!--                </ul>-->
                <ul class="clearfix" th:if="${good.getId()!=null}">
                    <li class="fl">
                        <img th:src="@{${good.getImage()}}" style="width: 87px;height: 87px;">
                    </li>
                    <li class="fl">
                        <p style="width:240px;height:auto;" th:text="${good.getName()}"></p>
                        <p style="width:240px;height:auto;" th:text="${good.getSku()}"></p>
                        <p th:text="'数量：'+${good.getGoodBuyNum()}"></p>
                        <input type="hidden" th:value="${good.getGoodBuyNum()}" id="num1">
                    </li>
                    <li class="fr" th:text="'￥'+${good.getGoodTotalPrice()}"></li>
                    <hr>
                </ul>
                </div>
            </div>
            <div>
                    <div class="tips">
                        <p><span class="fl">商品金额：</span><span class="fr" th:text="'￥'+${totalPrice}"></span></p>
                        <p><span class="fl">优惠金额：</span><span class="fr">￥0.00</span></p>
                        <p><span class="fl">运费：</span><span class="fr">免运费</span></p>
                    </div>
                    <div class="count tips">
                        <p><span class="fl">合计：</span><span class="fr" th:text="'￥'+${totalPrice}"></span></p>
                    </div>

                <a href="#" class="pay" onclick="pay()">去支付</a>
            </div>
        </div>
    </div>


</div>
<script type="text/javascript">
    layui.use(['form','layer','laydate',"upload"], function() {
        var form = layui.form;
        var layer=layui.layer;
        var laydate = layui.laydate;
        var upload = layui.upload;

        //设为默认地址
        setDefault = function (id) {
            $.ajax({
                type:"post",
                url:"/address/setDefault",
                data: {
                    id : id
                },
                success:function (data) {
                    if (data.code == 200){
                        layer.msg("修改地址成功，请重新结算", {icon:1, time:1500, shade:0.4}, function () {
                            window.location.href = "/cart/getAll"
                        })

                    } else {
                        layer.msg(data.msg, {icon:2, time:1500, shade:0.4})
                    }
                },
                error:function (data) {
                    layer.msg("请求失败");
                }
            })
        }

        //下单支付
        pay = function() {
            $.ajax({
                type:"post",
                url:"/order/createOrder",
                success:function(data){
                    if (data.code == 200){
                        layer.msg("支付成功",{icon:1, time:1000, shade:0.4},function () {
                            window.location.href="/order/getAll"
                        });
                    } else {
                        layer.confirm(data.msg)
                    }
                },
                error:function () {
                    layer.msg("请求失败",{icon:5});
                }
            });
        }

        $("#logout").click(function () {
            layer.open({
                title:'提示',
                type:1,
                offset:'auto',
                content:'<div style="padding: 20px 60px;font-size: 15px">'+ '您是否确定注销登录?' +'</div>',
                btn:['确定','取消'],
                btnAlign:'c',
                shade:0,
                yes:function () {
                    $.ajax({
                        type:"get",
                        url:"/user/logout",
                        success:function(data){
                            if (data.code == 200){
                                window.location.href="/userLogin";
                            }else {
                                layer.msg("注销登录失败",{icon:5});
                            }
                        },
                        error:function () {
                            layer.msg("请求失败",{icon:5});
                        }
                    });
                },
                btn2:function () {
                    layer.closeAll();
                }
            });
        });
    });
</script>

</body>
</html>